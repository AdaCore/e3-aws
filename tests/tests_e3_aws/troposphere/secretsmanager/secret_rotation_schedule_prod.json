{
    "TestSecret": {
        "Properties": {
            "Description": "TestSecret description",
            "Name": "TestSecret"
        },
        "Type": "AWS::SecretsManager::Secret"
    },
    "TestSecretRotationPolicy": {
        "Properties": {
            "Description": "Managed policy granting permissionsto rotate the TestSecret secret",
            "ManagedPolicyName": "TestSecretRotationPolicy",
            "PolicyDocument": {
                "Version": "2012-10-17",
                "Statement": [
                    {
                        "Effect": "Allow",
                        "Action": [
                            "secretsmanager:DescribeSecret",
                            "secretsmanager:GetSecretValue",
                            "secretsmanager:PutSecretValue",
                            "secretsmanager:UpdateSecretVersionStage"
                        ],
                        "Resource": {
                            "Ref": "TestSecret"
                        }
                    }
                ]
            },
            "Path": "/"
        },
        "Type": "AWS::IAM::ManagedPolicy"
    },
    "Myrotationlambda": {
        "Properties": {
            "Code": {
                "S3Bucket": "cfn_bucket",
                "S3Key": {
                    "Fn::Sub": "assets/${MyrotationlambdaSourcesS3Key}"
                }
            },
            "Timeout": 3,
            "Description": "this is a test",
            "Role": "somearn",
            "FunctionName": "myrotationlambda",
            "Runtime": "python3.9",
            "Handler": "app.main"
        },
        "Type": "AWS::Lambda::Function"
    },
    "MyrotationlambdaLogGroup": {
        "Properties": {
            "LogGroupName": "/aws/lambda/myrotationlambda",
            "RetentionInDays": 731
        },
        "Type": "AWS::Logs::LogGroup",
        "DeletionPolicy": "Retain",
        "UpdateReplacePolicy": "Retain"
    },
    "MyrotationlambdaVersion1": {
        "Properties": {
            "Description": "version 1 of myrotationlambda lambda",
            "FunctionName": {
                "Fn::GetAtt": [
                    "Myrotationlambda",
                    "Arn"
                ]
            }
        },
        "Type": "AWS::Lambda::Version"
    },
    "MyrotationlambdaProd": {
        "Properties": {
            "Description": "Prod version of myrotationlambda",
            "FunctionName": {
                "Fn::GetAtt": [
                    "Myrotationlambda",
                    "Arn"
                ]
            },
            "FunctionVersion": {
                "Fn::GetAtt": [
                    "MyrotationlambdaVersion1",
                    "Version"
                ]
            },
            "Name": "prod"
        },
        "Type": "AWS::Lambda::Alias"
    },
    "MyrotationlambdaProdpermission": {
        "Properties": {
            "Action": "lambda:InvokeFunction",
            "FunctionName": {
                "Ref": "MyrotationlambdaProd"
            },
            "Principal": "secretsmanager.amazonaws.com",
            "SourceArn": {
                "Ref": "TestSecret"
            }
        },
        "Type": "AWS::Lambda::Permission"
    },
    "TestSecretRotationSchedule": {
        "Properties": {
            "RotationLambdaARN": {
                "Ref": "MyrotationlambdaProd"
            },
            "RotationRules": {
                "ScheduleExpression": "rate(4 days)"
            },
            "SecretId": {
                "Ref": "TestSecret"
            }
        },
        "Type": "AWS::SecretsManager::RotationSchedule",
        "DependsOn": "MyrotationlambdaProdpermission"
    }
}